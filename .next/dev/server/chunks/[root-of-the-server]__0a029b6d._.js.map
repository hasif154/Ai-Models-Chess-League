{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/d%20drive%20downloads/Coding/Ai%20chess/app/api/chess/move/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { Chess } from \"chess.js\";\r\n\r\n// Utility: Sleep for a given number of milliseconds\r\nfunction sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n// Retry configuration\r\nconst MAX_RETRIES = 3;\r\nconst INITIAL_DELAY_MS = 2000; // 2 seconds\r\n\r\nexport async function POST(req: NextRequest) {\r\n    let legalMoves: string[] = [];\r\n    let cleanModel = \"unknown\";\r\n\r\n    try {\r\n        // Parse request body with error handling\r\n        let requestBody;\r\n        try {\r\n            requestBody = await req.json();\r\n        } catch (parseError) {\r\n            console.error(\"Failed to parse request body:\", parseError);\r\n            return NextResponse.json({ error: \"Invalid request body\" }, { status: 400 });\r\n        }\r\n\r\n        const { apiKeys, model, role, fen, history } = requestBody;\r\n\r\n        console.log(\"=== Chess Move Request ===\");\r\n        console.log(\"Model:\", model);\r\n        console.log(\"Role:\", role);\r\n        console.log(\"FEN:\", fen);\r\n        console.log(\"History length:\", history?.length || 0);\r\n\r\n        // Validate required fields\r\n        if (!model || !fen) {\r\n            return NextResponse.json({ error: \"Missing required fields: model or fen\" }, { status: 400 });\r\n        }\r\n\r\n        // Determine which API to use based on model ID format\r\n        const isGroq = !model.includes(\"/\");\r\n        const apiKey = isGroq ? apiKeys?.groq : apiKeys?.openrouter;\r\n        const baseUrl = isGroq ? \"https://api.groq.com/openai/v1\" : \"https://openrouter.ai/api/v1\";\r\n        const providerName = isGroq ? \"Groq\" : \"OpenRouter\";\r\n\r\n        if (!apiKey) {\r\n            console.error(\"Missing API Key for:\", providerName);\r\n            return NextResponse.json({ error: `API key for ${providerName} not provided` }, { status: 400 });\r\n        }\r\n\r\n        // Initialize chess with FEN - with error handling\r\n        let chess: Chess;\r\n        try {\r\n            chess = new Chess(fen);\r\n        } catch (fenError) {\r\n            console.error(\"Invalid FEN:\", fen, fenError);\r\n            return NextResponse.json({ error: \"Invalid FEN position\" }, { status: 400 });\r\n        }\r\n\r\n        legalMoves = chess.moves();\r\n        console.log(\"Legal moves count:\", legalMoves.length);\r\n\r\n        if (legalMoves.length === 0) {\r\n            return NextResponse.json({\r\n                move: \"resign\",\r\n                thoughts: \"No legal moves available.\"\r\n            });\r\n        }\r\n\r\n        const systemPrompt = `You are a Grandmaster AI playing a chess match in the \"AI Chess League\".\r\nCurrent FEN: ${fen}\r\nPrevious moves: ${history && history.length > 0 ? history.join(\", \") : \"None (opening)\"}\r\nYou are playing as ${role}.\r\nLegal moves available: ${legalMoves.join(\", \")}\r\n\r\nYour goal is to win. Analyze the position carefully and choose the best move.\r\n\r\nCRITICAL: You MUST output ONLY a valid JSON object with this exact format:\r\n{\r\n  \"move\": \"<one of the legal moves listed above, e.g., e4 or Nf3>\",\r\n  \"thoughts\": \"<a natural paragraph explaining your strategic reasoning, no bullets, no headings, 1-2 sentences>\"\r\n}\r\n\r\nIMPORTANT:\r\n- The \"move\" field MUST be exactly one of the legal moves listed above\r\n- Use standard algebraic notation (e.g., e4, Nf3, O-O for castling, Qxd7+, etc.)\r\n- If the position is hopeless, you may use \"resign\" as the move\r\n- Output valid JSON only, no additional text`;\r\n\r\n        // Clean model name for API call\r\n        cleanModel = model;\r\n        if (model === \"Llama 3.3 70B\") cleanModel = \"llama-3.3-70b-versatile\";\r\n        else if (model === \"Llama 3.1 8B\") cleanModel = \"llama-3.1-8b-instant\";\r\n        else if (model === \"Mixtral 8x7B\") cleanModel = \"mixtral-8x7b-32768\";\r\n\r\n        const apiRequestBody: Record<string, unknown> = {\r\n            model: cleanModel,\r\n            messages: [\r\n                { role: \"system\", content: systemPrompt },\r\n                { role: \"user\", content: \"Choose your move. Remember to output valid JSON only.\" }\r\n            ],\r\n            temperature: 0.3,\r\n            max_tokens: 500,\r\n        };\r\n\r\n        // Add JSON response format for supported models\r\n        const supportsJson = isGroq ||\r\n            cleanModel.includes(\"gpt\") ||\r\n            cleanModel.includes(\"claude-3-5\") ||\r\n            cleanModel.includes(\"gemini-2.0\");\r\n\r\n        if (supportsJson) {\r\n            apiRequestBody.response_format = { type: \"json_object\" };\r\n        }\r\n\r\n        console.log(`Requesting move from ${cleanModel} via ${providerName}`);\r\n\r\n        // Retry loop with exponential backoff\r\n        let response: Response | null = null;\r\n        let lastError: string = \"\";\r\n\r\n        for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {\r\n            try {\r\n                response = await fetch(`${baseUrl}/chat/completions`, {\r\n                    method: \"POST\",\r\n                    headers: {\r\n                        \"Authorization\": `Bearer ${apiKey}`,\r\n                        \"Content-Type\": \"application/json\",\r\n                        ...(isGroq ? {} : {\r\n                            \"HTTP-Referer\": \"https://ai-chess-league.com\",\r\n                            \"X-Title\": \"AI Chess League\"\r\n                        }),\r\n                    },\r\n                    body: JSON.stringify(apiRequestBody),\r\n                });\r\n\r\n                // Check if successful\r\n                if (response.ok) {\r\n                    console.log(`API request succeeded on attempt ${attempt + 1}`);\r\n                    break;\r\n                }\r\n\r\n                // Handle rate limiting with retry\r\n                if (response.status === 429) {\r\n                    const retryAfter = response.headers.get(\"retry-after\");\r\n                    const waitTime = retryAfter ? parseInt(retryAfter) * 1000 : INITIAL_DELAY_MS * Math.pow(2, attempt);\r\n\r\n                    console.warn(`Rate limited (429) on attempt ${attempt + 1}. Waiting ${waitTime}ms before retry...`);\r\n                    lastError = `Rate limited by ${providerName}`;\r\n\r\n                    if (attempt < MAX_RETRIES - 1) {\r\n                        await sleep(waitTime);\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                // Handle server errors with retry\r\n                if (response.status >= 500) {\r\n                    const waitTime = INITIAL_DELAY_MS * Math.pow(2, attempt);\r\n                    console.warn(`Server error (${response.status}) on attempt ${attempt + 1}. Waiting ${waitTime}ms before retry...`);\r\n                    lastError = `${providerName} server error (${response.status})`;\r\n\r\n                    if (attempt < MAX_RETRIES - 1) {\r\n                        await sleep(waitTime);\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                // Non-retryable errors\r\n                if (response.status === 401) {\r\n                    return NextResponse.json({ error: `Invalid ${providerName} API Key` }, { status: 401 });\r\n                }\r\n\r\n                if (response.status === 402) {\r\n                    lastError = `${providerName} requires payment or credits`;\r\n                    break;\r\n                }\r\n\r\n                // Other errors - log and break\r\n                const errorText = await response.text();\r\n                console.error(`API Error (${response.status}):`, errorText);\r\n                lastError = `${providerName} error: ${response.status}`;\r\n                break;\r\n\r\n            } catch (fetchError: unknown) {\r\n                console.error(`Fetch error on attempt ${attempt + 1}:`, fetchError);\r\n                lastError = \"Network connection error\";\r\n\r\n                if (attempt < MAX_RETRIES - 1) {\r\n                    const waitTime = INITIAL_DELAY_MS * Math.pow(2, attempt);\r\n                    await sleep(waitTime);\r\n                    continue;\r\n                }\r\n            }\r\n        }\r\n\r\n        // If all retries failed, return a fallback move\r\n        if (!response || !response.ok) {\r\n            const fallbackMove = legalMoves[Math.floor(Math.random() * legalMoves.length)];\r\n            console.warn(`All ${MAX_RETRIES} attempts failed. Using fallback move: ${fallbackMove}`);\r\n\r\n            let errorMessage = lastError || \"API unavailable\";\r\n\r\n            // Provide specific guidance for OpenRouter limits\r\n            if (!isGroq && lastError.includes(\"Rate limited\")) {\r\n                errorMessage = \"OpenRouter rate limit reached (50/day free tier). Consider using Groq models.\";\r\n            }\r\n\r\n            return NextResponse.json({\r\n                move: fallbackMove,\r\n                thoughts: `${errorMessage} Playing ${fallbackMove}.`\r\n            });\r\n        }\r\n\r\n        // Parse API response with error handling\r\n        let data;\r\n        try {\r\n            data = await response.json();\r\n        } catch (jsonError) {\r\n            console.error(\"Failed to parse API response:\", jsonError);\r\n            const fallbackMove = legalMoves[Math.floor(Math.random() * legalMoves.length)];\r\n            return NextResponse.json({\r\n                move: fallbackMove,\r\n                thoughts: \"Response parsing failed, playing a legal move.\"\r\n            });\r\n        }\r\n\r\n        if (!data.choices || !data.choices[0] || !data.choices[0].message) {\r\n            console.error(\"Unexpected API response structure:\", JSON.stringify(data));\r\n            const fallbackMove = legalMoves[Math.floor(Math.random() * legalMoves.length)];\r\n            return NextResponse.json({\r\n                move: fallbackMove,\r\n                thoughts: \"Unexpected API response, playing a legal move.\"\r\n            });\r\n        }\r\n\r\n        const content = data.choices[0].message.content;\r\n        console.log(`AI Response from ${cleanModel}:`, content?.substring(0, 200));\r\n\r\n        if (!content) {\r\n            const fallbackMove = legalMoves[Math.floor(Math.random() * legalMoves.length)];\r\n            return NextResponse.json({\r\n                move: fallbackMove,\r\n                thoughts: \"Empty AI response, playing a legal move.\"\r\n            });\r\n        }\r\n\r\n        // Parse JSON from response with multiple fallback strategies\r\n        let parsed: { move?: string; thoughts?: string } = {};\r\n\r\n        // Strategy 1: Direct JSON parse\r\n        try {\r\n            parsed = JSON.parse(content);\r\n        } catch {\r\n            // Strategy 2: Extract JSON from text\r\n            const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\r\n            if (jsonMatch) {\r\n                try {\r\n                    parsed = JSON.parse(jsonMatch[0]);\r\n                } catch {\r\n                    // Continue to text extraction\r\n                }\r\n            }\r\n        }\r\n\r\n        // Strategy 3: Extract move from text patterns\r\n        if (!parsed.move) {\r\n            const movePatterns = [\r\n                /[\"']?move[\"']?\\s*[:\\-]\\s*[\"']?([a-zA-Z0-9\\-\\+\\=\\#]+)[\"']?/i,\r\n                /\\b(O-O-O|O-O)\\b/,\r\n                /\\b([NBRQK]?[a-h]?[1-8]?x?[a-h][1-8](?:=[NBRQ])?[\\+\\#]?)\\b/\r\n            ];\r\n\r\n            for (const pattern of movePatterns) {\r\n                const match = content.match(pattern);\r\n                if (match && match[1]) {\r\n                    // Verify this is actually a legal move\r\n                    if (legalMoves.some(m => m.toLowerCase() === match[1].toLowerCase())) {\r\n                        parsed.move = match[1];\r\n                        parsed.thoughts = parsed.thoughts || \"Move extracted from response.\";\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Strategy 4: Pick random legal move as last resort\r\n        if (!parsed.move) {\r\n            parsed.move = legalMoves[Math.floor(Math.random() * legalMoves.length)];\r\n            parsed.thoughts = \"Could not parse AI response, playing a legal move.\";\r\n            console.warn(`Failed to parse move from ${cleanModel}, using fallback: ${parsed.move}`);\r\n        }\r\n\r\n        // Validate and correct the move\r\n        if (parsed.move && parsed.move.toLowerCase() !== \"resign\") {\r\n            const testChess = new Chess(fen);\r\n            let moveValid = false;\r\n\r\n            try {\r\n                const testMove = testChess.move(parsed.move);\r\n                moveValid = !!testMove;\r\n            } catch {\r\n                moveValid = false;\r\n            }\r\n\r\n            if (!moveValid) {\r\n                // Try fuzzy matching against legal moves\r\n                const inputMove = parsed.move.toLowerCase().replace(/[^a-z0-9]/g, '');\r\n                const matchedMove = legalMoves.find(m => {\r\n                    const cleanM = m.toLowerCase().replace(/[^a-z0-9]/g, '');\r\n                    return cleanM === inputMove || cleanM.includes(inputMove) || inputMove.includes(cleanM);\r\n                });\r\n\r\n                if (matchedMove) {\r\n                    console.log(`Corrected move from \"${parsed.move}\" to \"${matchedMove}\"`);\r\n                    parsed.thoughts = `${parsed.thoughts || \"\"} (Corrected to ${matchedMove})`.trim();\r\n                    parsed.move = matchedMove;\r\n                } else {\r\n                    // Use random legal move\r\n                    const randomMove = legalMoves[Math.floor(Math.random() * legalMoves.length)];\r\n                    console.warn(`Invalid move \"${parsed.move}\" from ${cleanModel}, using ${randomMove}`);\r\n                    parsed.thoughts = `Move corrected to ${randomMove}.`;\r\n                    parsed.move = randomMove;\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log(\"=== Returning Move ===\", parsed.move);\r\n\r\n        return NextResponse.json({\r\n            move: parsed.move || legalMoves[0],\r\n            thoughts: parsed.thoughts || \"Strategic move played.\"\r\n        });\r\n\r\n    } catch (error: unknown) {\r\n        const err = error as Error;\r\n        console.error(\"=== Move API Unhandled Error ===\");\r\n        console.error(\"Error:\", err.message);\r\n        console.error(\"Stack:\", err.stack);\r\n\r\n        // Even on unhandled errors, try to return a legal move if we have them\r\n        if (legalMoves.length > 0) {\r\n            const fallbackMove = legalMoves[Math.floor(Math.random() * legalMoves.length)];\r\n            return NextResponse.json({\r\n                move: fallbackMove,\r\n                thoughts: \"An error occurred, playing a safe move.\"\r\n            });\r\n        }\r\n\r\n        return NextResponse.json({\r\n            error: err.message || \"Unknown error\",\r\n            stack: process.env.NODE_ENV === 'development' ? err.stack : undefined\r\n        }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}