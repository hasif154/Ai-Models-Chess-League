{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/d%20drive%20downloads/Coding/Ai%20chess/app/api/chess/commentary/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n    const { apiKeys, fen, history } = await req.json();\r\n\r\n    const apiKey = apiKeys.groq;\r\n\r\n    if (!apiKey) {\r\n        return NextResponse.json({ commentary: \"Waiting for the next exchange...\" });\r\n    }\r\n\r\n    const baseUrl = \"https://api.groq.com/openai/v1\";\r\n\r\n    const systemPrompt = `You are a brutal, cynical chess commentator for the \"AI Chess League\".\r\nCurrent FEN: ${fen}\r\nPrevious moves: ${history.slice(-4).join(\", \")}\r\n\r\nProvide a short, brutal paragraph of commentary on the current state of the game. \r\nNo headings, no bullets. Max 2 sentences.\r\nOutput ONLY a JSON object:\r\n{\r\n  \"commentary\": \"<your brutal insight>\"\r\n}`;\r\n\r\n    try {\r\n        const response = await fetch(`${baseUrl}/chat/completions`, {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Authorization\": `Bearer ${apiKey}`,\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({\r\n                model: \"llama-3.1-8b-instant\",\r\n                messages: [{ role: \"system\", content: systemPrompt }],\r\n                response_format: { type: \"json_object\" },\r\n            }),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            return NextResponse.json({ commentary: \"The tension is rising, but I'm speechless.\" });\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (!data.choices?.[0]?.message?.content) {\r\n            throw new Error(\"Invalid response from Groq\");\r\n        }\r\n\r\n        const content = JSON.parse(data.choices[0].message.content);\r\n        return NextResponse.json({\r\n            commentary: content.commentary || \"An interesting development, to say the least.\"\r\n        });\r\n    } catch (error: any) {\r\n        console.error(\"Commentary API Error:\", error);\r\n        return NextResponse.json({ commentary: \"The players are locked in a silent struggle.\" });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,GAAgB;IACvC,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;IAEhD,MAAM,SAAS,QAAQ,IAAI;IAE3B,IAAI,CAAC,QAAQ;QACT,OAAO,6JAAY,CAAC,IAAI,CAAC;YAAE,YAAY;QAAmC;IAC9E;IAEA,MAAM,UAAU;IAEhB,MAAM,eAAe,CAAC;aACb,EAAE,IAAI;gBACH,EAAE,QAAQ,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM;;;;;;;CAO9C,CAAC;IAEE,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,iBAAiB,CAAC,EAAE;YACxD,QAAQ;YACR,SAAS;gBACL,iBAAiB,CAAC,OAAO,EAAE,QAAQ;gBACnC,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;gBACjB,OAAO;gBACP,UAAU;oBAAC;wBAAE,MAAM;wBAAU,SAAS;oBAAa;iBAAE;gBACrD,iBAAiB;oBAAE,MAAM;gBAAc;YAC3C;QACJ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,OAAO,6JAAY,CAAC,IAAI,CAAC;gBAAE,YAAY;YAA6C;QACxF;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,KAAK,OAAO,EAAE,CAAC,EAAE,EAAE,SAAS,SAAS;YACtC,MAAM,IAAI,MAAM;QACpB;QAEA,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QAC1D,OAAO,6JAAY,CAAC,IAAI,CAAC;YACrB,YAAY,QAAQ,UAAU,IAAI;QACtC;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,6JAAY,CAAC,IAAI,CAAC;YAAE,YAAY;QAA+C;IAC1F;AACJ"}}]
}